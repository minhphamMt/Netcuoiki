@model BTAPLON.Models.ViewModels.DashboardClassDetailViewModel
@{
    var classLabel = !string.IsNullOrWhiteSpace(Model.ClassCode)
        ? Model.ClassCode
        : $"Lớp #{Model.ClassID}";

    ViewData["Title"] = $"{Model.CourseName} - {classLabel}";
}

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<div class="container my-4">

    <!-- HEADER -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 p-4">
        <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">

            <div>
                <h1 class="fw-bold mb-1">
                    <i class="fa-solid fa-graduation-cap text-primary me-2"></i>@Model.CourseName
                </h1>
                <h5 class="text-muted mb-1">
                    <i class="fa-solid fa-chalkboard me-1"></i>@classLabel
                </h5>

                <p class="text-muted mb-1">
                    <i class="fa-solid fa-calendar-days me-1"></i>
                    @if (!string.IsNullOrWhiteSpace(Model.Semester))
                    {
                        @Model.Semester
                    }
                    @if (Model.Year.HasValue)
                    {
                        @(" - " + Model.Year)
                    }
                </p>

                <p class="text-muted mb-0">
                    <i class="fa-solid fa-user-tie me-1"></i>Giảng viên: @Model.TeacherName
                </p>
            </div>

            <div class="d-flex flex-wrap gap-2">
                <a class="btn btn-outline-secondary rounded-3"
                   asp-controller="Dashboard" asp-action="Index">
                    <i class="fa-solid fa-arrow-left me-1"></i>Quay lại
                </a>

                @if (Model.CourseID.HasValue)
                {
                    <a class="btn btn-outline-secondary rounded-3"
                       asp-controller="Dashboard" asp-action="Course" asp-route-id="@Model.CourseID">
                        <i class="fa-solid fa-book-open me-1"></i>Xem khóa học
                    </a>
                }

                <a class="btn btn-primary rounded-3"
                   asp-controller="Forum" asp-action="Index" asp-route-classId="@Model.ClassID">
                    <i class="fa-solid fa-comments me-1"></i>Diễn đàn lớp
                </a>

                <a class="btn btn-outline-primary rounded-3"
                   asp-controller="Forum" asp-action="CreateThread" asp-route-classId="@Model.ClassID">
                    <i class="fa-solid fa-pen-to-square me-1"></i>Tạo chủ đề
                </a>

                <a class="btn btn-outline-success rounded-3"
                   asp-controller="Forum" asp-action="AskQuestion" asp-route-classId="@Model.ClassID">
                    <i class="fa-solid fa-circle-question me-1"></i>Đặt câu hỏi
                </a>
            </div>

        </div>
    </div>


    <!-- ASSIGNMENTS -->
    <div class="card shadow-sm border-0 rounded-4 mb-5">
        <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 fw-bold mb-0">
                    <i class="fa-solid fa-file-lines text-primary me-2"></i>Bài tập
                </h3>
                <a asp-controller="Assignment" asp-action="Index"
                   class="btn btn-sm btn-outline-primary rounded-3">
                    Xem tất cả
                </a>
            </div>

            @if (Model.Assignments == null || !Model.Assignments.Any())
            {
                <p class="text-muted fst-italic">Chưa có bài tập nào.</p>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Tên bài tập</th>
                                <th>Hạn nộp</th>
                                <th class="text-end">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var a in Model.Assignments)
                            {
                                <tr>
                                    <td class="fw-semibold">@a.Title</td>
                                    <td>@(a.DueDate?.ToString("dd/MM/yyyy") ?? "Không có")</td>
                                    <td class="text-end">
                                        <a class="btn btn-sm btn-outline-secondary rounded-3"
                                           asp-controller="Assignment" asp-action="Details" asp-route-id="@a.AssignmentID">
                                            Xem
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>


    <!-- EXAMS -->
    <div class="card shadow-sm border-0 rounded-4 mb-5">
        <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 fw-bold mb-0">
                    <i class="fa-solid fa-file-pen text-danger me-2"></i>Bài kiểm tra
                </h3>

                @if (Model.CanManage)
                {
                    <a asp-controller="Exam" asp-action="Index"
                       class="btn btn-sm btn-outline-primary rounded-3">Quản lý</a>
                }
                else
                {
                    <a asp-controller="Exam" asp-action="Available"
                       class="btn btn-sm btn-outline-primary rounded-3">Danh sách bài thi</a>
                }
            </div>

            @if (Model.Exams == null || !Model.Exams.Any())
            {
                <p class="text-muted fst-italic">Chưa có bài kiểm tra.</p>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Tên bài kiểm tra</th>
                                <th>Mở</th>
                                <th>Đóng</th>
                                <th>Trạng thái</th>
                                <th class="text-end">Thao tác</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var exam in Model.Exams)
                            {
                                <tr>
                                    <td class="fw-semibold">@exam.Title</td>
                                    <td>@exam.StartTime?.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>@exam.EndTime?.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>
                                        @if (exam.IsPublished)
                                        {
                                            <span class="badge bg-success">Đang mở</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Chưa mở</span>
                                        }
                                    </td>

                                    <td class="text-end">
                                        @if (Model.CanManage)
                                        {
                                            <a class="btn btn-sm btn-outline-secondary rounded-3"
                                               asp-controller="Exam" asp-action="Manage" asp-route-id="@exam.ExamID">
                                                Quản lý
                                            </a>
                                        }
                                        else
                                        {
                                            <a class="btn btn-sm btn-outline-secondary rounded-3"
                                               asp-controller="Exam" asp-action="Take" asp-route-id="@exam.ExamID">
                                                Vào thi
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>

                    </table>
                </div>
            }
        </div>
    </div>


    <!-- RECENT THREADS -->
    <div class="card shadow-sm border-0 rounded-4 mb-5">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 fw-bold mb-0">
                    <i class="fa-solid fa-comments text-primary me-2"></i>Chủ đề thảo luận
                </h3>
                <a asp-controller="Forum" asp-action="CreateThread" asp-route-classId="@Model.ClassID"
                   class="btn btn-sm btn-outline-primary rounded-3">Tạo chủ đề</a>
            </div>

            @if (!Model.Threads?.Any() ?? true)
            {
                <p class="text-muted fst-italic">Chưa có chủ đề nào.</p>
            }
            else
            {
                <div class="list-group">
                    @foreach (var th in Model.Threads)
                    {
                        <a class="list-group-item list-group-item-action py-3"
                           asp-controller="Forum" asp-action="Thread" asp-route-id="@th.DiscussionThreadID">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="fw-semibold">@th.Title</div>
                                    <small class="text-muted">@th.AuthorName · @th.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                                </div>
                                <span class="badge bg-primary">@th.ReplyCount trả lời</span>
                            </div>
                        </a>
                    }
                </div>
            }
        </div>
    </div>


    <!-- QUESTIONS -->
    <div class="card shadow-sm border-0 rounded-4 mb-5">
        <div class="card-body p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 fw-bold mb-0">
                    <i class="fa-solid fa-circle-question text-warning me-2"></i>Câu hỏi mới nhất
                </h3>
                <a asp-controller="Forum" asp-action="AskQuestion" asp-route-classId="@Model.ClassID"
                   class="btn btn-sm btn-outline-success rounded-3">Đặt câu hỏi</a>
            </div>

            @if (!Model.Questions?.Any() ?? true)
            {
                <p class="text-muted fst-italic">Chưa có câu hỏi nào.</p>
            }
            else
            {
                <div class="list-group">
                    @foreach (var q in Model.Questions)
                    {
                        <a class="list-group-item list-group-item-action py-3"
                           asp-controller="Forum" asp-action="Question" asp-route-id="@q.QuestionID">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="fw-semibold">@q.Title</div>
                                    <small class="text-muted">@q.StudentName · @q.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                                </div>

                                @if (q.IsResolved)
                                {
                                    <span class="badge bg-success">Đã giải quyết</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Đang chờ</span>
                                }
                            </div>
                        </a>
                    }
                </div>
            }
        </div>
    </div>

</div>
